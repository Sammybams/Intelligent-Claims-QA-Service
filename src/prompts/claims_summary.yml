name: claims_summary
description: >
  Build a compact, human-readable claims summary JSON from OCR/text + structural hints.
placeholders:
  LANG: "en"
  DATE_FORMAT: "YYYY-MM-DD"
  CURRENCY_SYMBOL: "â‚¦"
  TABLE_ID_PREFIX: "table"
prompt: |
  You are a strict structured-output assistant. Input: OCR text snippets, key/value candidates and any tables.
  Task:
    - Extract and group all fields into the following top-level schema: patient, demographics, diagnoses,
      medications, procedures, admission, vitals, labs, billing, notes, tables, metadata.
    - Normalize keys and canonicalize date formats to {{DATE_FORMAT}}.
    - For monetary values include currency symbol in the string ({{CURRENCY_SYMBOL}}) and store a numeric field.
    - For each field include a "confidence" (0.0-1.0) and a "source" (e.g. "ocr_keyvalue", "inferred_regex", "table_row", "llm_inference").
    - For medications and tables: produce structured arrays of objects. For every table produce a unique id using prefix "{{TABLE_ID_PREFIX}}".
    - Provide short human-friendly "summary" strings where helpful (max 120 chars).
    - If multiple candidate values exist for a key, list them as ordered candidates with confidence scores.
  Output:
    - Must return the object exactly matching the function schema provided.
    - No explanatory text, only the JSON that will be passed back via the function call.
language: "{{LANG}}"
